<!-- include header -->
<%- include('include/_header') %>
<!-- /include header -->

<!-- Main Site -->
<main>
  <h1 id="title">Scan Tickets</h1>
  <div id="datafield"></div>
  <div class="container">
    <div id="scan-validity">
        <input type="text" id="barcodeInput" autofocus /></input>
      <div class="row" id="wait_status">
        <h2>Waiting for scan...</h2>
      </div>
      <div class="row" id="name"></div>
      <div class="row" id="id_number"></div>
      <div class="row" id="is_valid"></div>
      <div class="row" id="time_scanned"></div>
      <div class="row" id="ticket_row"></div>
    </div>
   <div id="buttons">
  <button class="button" id="import" onclick="promptPassword('import')">Import</button>
  <button class="button" id="export" onclick="promptPassword('export')">Export</button>
  <button class="button" id="revertImport" onclick="promptPassword('revert')">Revert Last Import</button>

  <!-- Password Input for Importing, Exporting, and Reverting -->
  <input class="button" id="passwordInput" type="password" style="display:none;" placeholder="Enter password" />
  <button class="button" id="confirmPassword" style="display:none;" onclick="confirmPassword()">Confirm</button>
  <button class="button" id="cancelPassword" style="display:none;" onclick="cancelPassword()">Cancel</button>

  <button class="button" id="override">Override</button>
  </div>

<script>
  let actionType = "";

  function promptPassword(action) {
    actionType = action;
    document.getElementById("import").style.display = "none";
    document.getElementById("export").style.display = "none";
    document.getElementById("revertImport").style.display = "none";
    document.getElementById("passwordInput").style.display = "block";
    document.getElementById("confirmPassword").style.display = "block";
    document.getElementById("cancelPassword").style.display = "block";
    document.getElementById("passwordInput").focus();
  }

  function confirmPassword() {
    const enteredPassword = document.getElementById("passwordInput").value;
    const correctPassword = "admin123"; // Change to your actual password

    if (enteredPassword === correctPassword) {
      switch (actionType) {
        case "import":
          window.location.href = "/importNames";
          break;
        case "export":
          window.location.href = "/exportNames";
          break;
        case "revert":
          if (confirm("Are you sure you want to revert the last import?")) {
            fetch("/revertDatabase", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
            })
              .then((response) => response.json())
              .then((data) => {
                alert(data.message);
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          }
          break;
      }
    } else {
      alert("Incorrect password. Access denied.");
    }

    cancelPassword();
  }

  function cancelPassword() {
    document.getElementById("passwordInput").value = "";
    document.getElementById("import").style.display = "block";
    document.getElementById("export").style.display = "block";
    document.getElementById("revertImport").style.display = "block";
    document.getElementById("passwordInput").style.display = "none";
    document.getElementById("confirmPassword").style.display = "none";
    document.getElementById("cancelPassword").style.display = "none";
  }
</script>

<!-- include footer -->
<%- include('include/_footer') %>
<!-- /include footer -->
